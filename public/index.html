<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Freetalk Community Â· ë©”ì¸</title>
<link rel="icon" type="image/png" href="/img/icon1101.png">
<link rel="apple-touch-icon" href="/img/icon1101.png">
<meta name="theme-color" content="#0b1020"/>

<style>
:root{
  --bg:#0b1020;--panel:#121831;--ink:#e5e7eb;--muted:#9aa3b2;--bd:#1f2745;
  --accent:#7c3aed;--accent2:#8b5cf6;--danger:#ef4444;--ok:#10b981;
  --radius:16px;--max:1200px;--soft:linear-gradient(180deg,#121831,#0f1733);
}

html,body{height:100%;margin:0;padding:0}
body{
  background:linear-gradient(180deg,#0b1020,#0f1530);
  color:var(--ink);font:15px/1.6 'Inter',system-ui,-apple-system,Segoe UI,Roboto,Malgun Gothic,sans-serif;
}
a{color:inherit;text-decoration:none}

/* ===== ê³µí†µ ì¹´ë“œ / ë ˆì´ì•„ì›ƒ ===== */
.wrap{max-width:var(--max);margin:20px auto;padding:0 16px}
.card{background:var(--soft);border:1px solid var(--bd);border-radius:var(--radius);
  box-shadow:0 12px 40px rgba(8,12,30,.35);padding:16px;}
.card h3{margin:0 0 10px;font-size:14px;font-weight:600;color:var(--muted)}
.list{display:flex;flex-direction:column;gap:10px}
.item{padding:12px;border:1px solid var(--bd);border-radius:12px;background:rgba(18,24,49,.5)}
.meta{color:var(--muted);font-size:12px}

/* ===== ë²„íŠ¼ ===== */
.btn{border:1px solid var(--bd);background:#0e1430;color:var(--ink);
  padding:10px 14px;border-radius:12px;cursor:pointer;transition:.2s}
.btn:hover{border-color:#2a3562}
.btn.primary{background:linear-gradient(135deg,var(--accent),var(--accent2));border:0}
.badge{display:inline-flex;align-items:center;border:1px solid var(--bd);
  border-radius:999px;padding:5px 9px;font-size:12px;background:#0d1430;color:#b7c1d9}

/* ===== í—¤ë” ===== */
.top{
  display:flex;align-items:center;justify-content:space-between;
  flex-wrap:nowrap;margin-bottom:14px;
}
.brand{display:flex;align-items:center;gap:10px;flex-shrink:0}
.brand b{font-size:18px}
.nav{display:flex;gap:8px;flex-wrap:wrap}

/* ===== í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼ ===== */
.menu-btn{
  display:none;font-size:22px;background:none;border:0;color:var(--ink);
  cursor:pointer;padding:4px 8px;line-height:1;
}
@media (max-width:768px){
  .menu-btn{display:block}
  .nav{display:none} /* â† ëª¨ë°”ì¼ì—ì„œ ìƒë‹¨ ë²„íŠ¼ ìˆ¨ê¹€ */
}

/* ===== ë©”ì¸ ë ˆì´ì•„ì›ƒ ===== */
.grid{display:grid;grid-template-columns:280px 1fr 280px;gap:14px}
@media (max-width:1024px){.grid{grid-template-columns:240px 1fr}}
@media (max-width:768px){.grid{grid-template-columns:1fr}}

/* ===== ëª¨ë°”ì¼ í–„ë²„ê±° - ê²Œì‹œíŒ ===== */
aside.card{
  transition:transform .25s ease, opacity .25s ease;
}
@media (max-width:768px){
  aside.card{
    position:fixed;top:0;left:0;width:100%;height:100%;
    background:rgba(11,16,32,.98);
    backdrop-filter:blur(6px);
    z-index:4000;
    transform:translateX(-100%);
    opacity:0;
    overflow:auto;padding:20px;
  }
  aside.card.open{
    transform:translateX(0);
    opacity:1;
  }
}

/* ë‹«ê¸° ë²„íŠ¼ */
.menu-close{
  display:none;
  position:absolute;top:16px;right:16px;
  background:#1a2142;border:1px solid var(--bd);
  color:var(--ink);padding:6px 10px;border-radius:8px;cursor:pointer;
}
@media (max-width:768px){
  .menu-close{display:block}
}

/* ===== í”„ë¡œí•„ ì¹´ë“œ ===== */
.mini{display:grid;grid-template-columns:72px 1fr;gap:10px;align-items:center}
.av{width:72px;height:72px;border-radius:16px;border:2px solid #fff;
  box-shadow:0 4px 12px rgba(0,0,0,.25);background:#0c1330;
  display:grid;place-items:center;font-weight:800}
.nick{font-weight:800}
.sub{font-size:12px;color:var(--muted);margin-top:2px}

/* ===== ê²Œì‹œê¸€ ëª©ë¡ ===== */
.post-row{
  display:flex;justify-content:space-between;align-items:center;
  border:1px solid var(--bd);border-radius:12px;padding:10px 12px;
  background:rgba(18,24,49,.45);transition:.2s;
}
.post-row:hover{background:rgba(28,36,66,.6)}
.post-title{font-weight:600;font-size:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.post-meta{font-size:12px;color:var(--muted)}
@media (max-width:768px){
  .post-row{flex-direction:column;align-items:flex-start;gap:2px}
  .post-meta{font-size:11px;color:#9ca3af}
}

/* ===== ì±„íŒ… í”Œë¡œíŒ… ===== */
.chat-fab{
  position:fixed;right:16px;bottom:calc(78px + env(safe-area-inset-bottom));
  z-index:2000;width:52px;height:52px;border-radius:999px;
  background:linear-gradient(180deg,var(--accent2),var(--accent));
  border:1px solid #6d28d9;color:#fff;font-weight:700;cursor:pointer;
  box-shadow:0 12px 28px rgba(0,0,0,.28);
  display:flex;align-items:center;justify-content:center;
}
#chat-fab-badge{
  position:absolute;top:6px;right:6px;width:16px;height:16px;
  border-radius:50%;background:#ef4444;color:#fff;font-size:10px;
  font-weight:700;display:none;align-items:center;justify-content:center;
}



/* ===== ì±„íŒ… ì˜¤ë²„ë ˆì´ (ëª¨ë°”ì¼ ì „ìš© ìµœì í™”) ===== */
.chat-dim {
  position: fixed;
  inset: 0;
  background: rgba(8,10,18,.45);
  backdrop-filter: blur(3px);
  display: none;
  z-index: 1999;
}

.chat-drawer {
  position: fixed;
  top: 0; right: 0;
  width: min(720px, 100%);
  height: 100dvh;  /* âœ… ëª¨ë°”ì¼ í™˜ê²½ì—ì„œë„ ì•ˆì „í•˜ê²Œ ì „ì²´ í™”ë©´ */
  background: #0e1328;
  border-left: 1px solid var(--bd);
  box-shadow: -14px 0 40px rgba(0,0,0,.35);
  transform: translateX(100%);
  transition: transform .25s ease;
  z-index: 2000;
  display: flex;
  flex-direction: column;
  overflow: hidden; /* âœ… body ìŠ¤í¬ë¡¤ ë°©ì§€ */
}

.chat-drawer.open {
  transform: translateX(0);
}

.chat-head {
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 14px;
  background: linear-gradient(180deg,#121831,#0f142d);
  border-bottom: 1px solid var(--bd);
}

.chat-iframe {
  flex: 1;
  width: 100%;
  border: 0;
  background: #111421;
  height: calc(100% - 48px); /* âœ… í—¤ë” ì œì™¸ ë‚˜ë¨¸ì§€ ê½‰ ì±„ì›€ */
}
.chat-close {
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid var(--bd);
  background: #1a2142;
  color: #fff;
  cursor: pointer;
  font-size: 14px;
}

/* âœ… ëª¨ë°”ì¼ì—ì„œ ì—¬ë°± ì—†ê²Œ ì²˜ë¦¬ */
@media (max-width:768px){
  .chat-drawer {
    width: 100%;
    border-radius: 0;
  }
}

/* ===== ëª¨ë°”ì¼ íƒ­ë°” ===== */
.mobile-tabbar{display:none}
@media (max-width:768px){
  body.has-tabbar{padding-bottom:78px}
  .mobile-tabbar{
    position:fixed;left:0;right:0;bottom:0;z-index:1000;
    display:flex;justify-content:space-around;align-items:center;
    height:62px;padding-bottom:calc(env(safe-area-inset-bottom));
    background:linear-gradient(180deg,#0f1530,#0b1020);
    border-top:1px solid var(--bd);
    box-shadow:0 -8px 30px rgba(8,12,30,.35);
  }
  .mobile-tabbar a{
    flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;
    color:#b9c0d4;text-decoration:none;font-size:11px;padding-top:6px
  }
  .mobile-tabbar svg{width:22px;height:22px;opacity:.9}
  .mobile-tabbar a.active{color:#fff}
  .mobile-tabbar a.active svg{filter:drop-shadow(0 0 6px rgba(124,58,237,.65))}
}

/* ===== ì´ë¯¸ì§€ ë°˜ì‘í˜• ===== */
.feed img{
  width:100%;height:auto;max-height:480px;object-fit:contain;
  border-radius:12px;border:1px solid #1f274a;background:#0b1120;
  margin-top:8px;
}
@media (max-width:768px){.feed img{max-height:320px}}




</style>
</head>
<body>
<div class="wrap">
  <header class="top">
    <div class="brand">
      <button id="menu-btn" class="menu-btn" aria-label="ê²Œì‹œíŒ ë©”ë‰´">â˜°</button>
      <img src="/img/icon1101.png" alt="" style="width:26px;height:26px;border-radius:6px"/>
      <b>Freetalk Community</b>
    </div>
    <nav class="nav">
      <a class="btn" href="/posting.html">ê¸€ì“°ê¸°</a>
      <a class="btn" href="/woori.html">ì—…ë¬´ë“±ë¡</a>
      <a class="btn" href="/woori-dashboard.html">ëŒ€ì‹œë³´ë“œ</a>
      <a class="btn" href="/chat.html">ì±„íŒ…</a>
      <a class="btn primary" id="btn-login" href="/login.html">ë¡œê·¸ì¸</a>
    </nav>
  </header>

  <main class="grid">
    <!-- ì¢Œì¸¡ í”„ë¡œí•„ -->
    <section class="card">
      <h3>ë‚´ ì •ë³´</h3>
      <div class="mini">
        <div class="av" id="av">
          <img id="av-img" style="display:none;width:100%;height:100%;object-fit:cover;border-radius:16px"/>
          <span id="av-initial" style="font-size:22px"></span>
        </div>
        <div>
          <div class="nick" id="nick">ê²ŒìŠ¤íŠ¸</div>
          <div class="sub" id="bio-sub">ì†Œê°œê¸€ì„ ì„¤ì •í•´ ë³´ì„¸ìš”.</div>
        </div>
      </div>
      <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
        <span class="badge">ì˜¤ëŠ˜ ë°©ë¬¸ <b id="vis-today">0</b></span>
        <span class="badge">ì´ ë°©ë¬¸ <b id="vis-total">0</b></span>
      </div>

      <div style="height:12px"></div>
      <h3>ë°©ëª…ë¡</h3>
      <div id="guestbook" class="list"><div class="item"><div class="meta">ì²« ì¸ì‚¬ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”!</div></div></div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="gb-input" class="btn" style="flex:1;background:#0d1430;border-radius:10px" placeholder="ë°©ëª…ë¡ ë‚¨ê¸°ê¸°">
        <button id="gb-add" class="btn">ë“±ë¡</button>
      </div>
    </section>

    <!-- ì¤‘ì•™ í”¼ë“œ -->
    <section class="card feed">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3>ì „ì²´ ê¸€ë³´ê¸°</h3>
        <span id="post-count" class="badge">0 posts</span>
      </div>
      <div id="feed" class="list"></div>
    </section>

    <!-- ìš°ì¸¡ ê²Œì‹œíŒ -->
    <aside class="card" id="board-list">
      <h3>ê²Œì‹œíŒ</h3>
      <div class="list" id="boards"></div>
    </aside>
  </main>

  <footer style="padding:12px 0;color:var(--muted);text-align:center">
    <div class="badge">Â© 2025 Freetalk Â· Built with Firebase Â· HTML5 Â· CSS3 Â· PWA</div>
  </footer>
</div>

<!-- ëª¨ë°”ì¼ íƒ­ë°” -->
<nav class="mobile-tabbar" id="m-tabbar">
  <a href="/index.html" data-path="/index.html" class="active">
    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3 3 10v11h7v-6h4v6h7V10z"/></svg>
    <span>í™ˆ</span>
  </a>
  <a href="/profile.html" data-path="/profile.html">
    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5zm0 2c-5 0-9 2.5-9 5v1h18v-1c0-2.5-4-5-9-5z"/></svg>
    <span>í”„ë¡œí•„</span>
  </a>
  <a href="/woori.html" data-path="/woori.html">
    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 2h6v2h3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h3V2z"/></svg>
    <span>ì—…ë¬´ë“±ë¡</span>
  </a>
  <a href="/posting.html" data-path="/posting.html">
    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></svg>
    <span>ê¸€ì“°ê¸°</span>
  </a>
  <a href="/woori-dashboard.html" data-path="/woori-dashboard.html">
    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 3h8v8H3V3zm10 0h8v5h-8V3zM3 13h8v8H3v-8zm10 5h8v3h-8v-3zm0-7h8v6h-8v-6z"/></svg>
    <span>ëŒ€ì‹œë³´ë“œ</span>
  </a>
</nav>

<!-- ===== ì±„íŒ… ì˜¤ë²„ë ˆì´ ===== -->
<div id="chat-dim" class="chat-dim"></div>
<aside id="chat-drawer" class="chat-drawer">
  <div class="chat-head">
    <strong>ì‹¤ì‹œê°„ ì±„íŒ…</strong>
    <button id="chat-close" class="chat-close">ë‹«ê¸°</button>
  </div>
  <iframe id="chat-frame" class="chat-iframe" src="" title="Freetalk Chat"></iframe>
</aside>



<!-- ì±„íŒ… í”Œë¡œíŒ… -->
<button id="chat-fab" class="chat-fab">ğŸ’¬<span id="chat-fab-badge"></span></button>

<script type="module">
/* ===== Firebase ì´ˆê¸°í™” ===== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
import {
  getFirestore, collection, query, orderBy, limit, onSnapshot,
  doc, getDoc, addDoc, updateDoc, deleteDoc, serverTimestamp
} from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
import {
  getMessaging, getToken, onMessage, isSupported
} from "https://www.gstatic.com/firebasejs/12.3.0/firebase-messaging.js";

const cfg={apiKey:"AIzaSyACn_-2BLztKYmBKXtrKNtMsC-2Y238oug",
authDomain:"woori-1ecf5.firebaseapp.com",projectId:"woori-1ecf5",
storageBucket:"woori-1ecf5.firebasestorage.app",messagingSenderId:"1073097361525",
appId:"1:1073097361525:web:3218ced6a040aaaf4d503c"};
const app=initializeApp(cfg);
const auth=getAuth(app);
const db=getFirestore(app);

/* ===== ê³µìš© ìœ í‹¸ ===== */
const $=s=>document.querySelector(s);
const esc=s=>String(s||'').replace(/[&<>"]/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[m]||m));
const fmt=ts=>{try{const d=ts?.toDate?.()||new Date();return d.toLocaleString();}catch{return'';}};
let me=null,myNick='ê²ŒìŠ¤íŠ¸',isAdmin=false;

/* ===== ë°©ë¬¸ì ì¹´ìš´íŠ¸ ===== */
(function(){
  const todayKey=new Date().toISOString().slice(0,10);
  const T='ft_vis_total', D='ft_vis_'+todayKey;
  try{
    const t=Number(localStorage.getItem(T)||0)+1;localStorage.setItem(T,t);
    const d=Number(localStorage.getItem(D)||0)+1;localStorage.setItem(D,d);
    $('#vis-total').textContent=t;$('#vis-today').textContent=d;
  }catch{}
})();

/* ===== ë¡œê·¸ì¸ ìƒíƒœ ===== */
onAuthStateChanged(auth, async(u)=>{
  me = u;
  const avImg = $('#av-img');
  const avInitial = $('#av-initial');
  const bioSub = $('#bio-sub');

  if(u){
    try{
      // âœ… users/{uid} ë¬¸ì„œì—ì„œ ë‹‰ë„¤ì„, ì´ë¯¸ì§€ ë¶ˆëŸ¬ì˜¤ê¸°
      const us = await getDoc(doc(db,'users',u.uid));
      const data = us.data() || {};
      myNick = data.nickname || u.displayName || 'ì‚¬ìš©ì';
      $('#nick').textContent = myNick;
      $('#btn-login').textContent = 'ë‚´ í”„ë¡œí•„';
      $('#btn-login').href = '/profile.html';

      // âœ… í”„ë¡œí•„ ì´ë¯¸ì§€ ë°˜ì˜
      if(data.avatarUrl){
        avImg.src = data.avatarUrl;
        avImg.style.display = 'block';
        avInitial.textContent = '';
      } else {
        avImg.style.display = 'none';
        avInitial.textContent = myNick[0] || 'U';
      }

      // âœ… ì†Œê°œê¸€ ë¶ˆëŸ¬ì˜¤ê¸°
      try{
        const h = await getDoc(doc(db,'homes',u.uid));
        const bio = h.data()?.bio || 'ì†Œê°œê¸€ì„ ì„¤ì •í•´ ë³´ì„¸ìš”.';
        bioSub.textContent = bio;
      }catch{
        bioSub.textContent = 'ì†Œê°œê¸€ì„ ì„¤ì •í•´ ë³´ì„¸ìš”.';
      }

    }catch(e){
      console.warn('í”„ë¡œí•„ ë¡œë“œ ì‹¤íŒ¨:', e);
      avImg.style.display = 'none';
      avInitial.textContent = 'U';
    }

  }else{
    // âœ… ë¡œê·¸ì•„ì›ƒ ìƒíƒœ
    $('#nick').textContent = 'ê²ŒìŠ¤íŠ¸';
    avImg.style.display = 'none';
    avInitial.textContent = 'G';
    $('#btn-login').textContent = 'ë¡œê·¸ì¸';
    $('#btn-login').href = '/login.html';
    bioSub.textContent = 'ë¡œê·¸ì¸í•˜ê³  Minií™ˆì„ ì„¤ì •í•´ ë³´ì„¸ìš”.';
  }
});


/* ===== ê²Œì‹œíŒ ëª©ë¡ ===== */
onSnapshot(query(collection(db,'boards'),orderBy('order','asc')),(snap)=>{
  const el=$('#boards');el.innerHTML='';
  if(snap.empty){el.innerHTML='<div class="meta">ê²Œì‹œíŒì´ ì—†ìŠµë‹ˆë‹¤.</div>';return;}
  snap.forEach(d=>{
    const b=d.data();
    const row=document.createElement('div');row.className='post-row';
    row.innerHTML=`<div class="post-title">${esc(b.name||d.id)}</div>
                   <div class="post-meta">${b.postCount||0} posts</div>`;
    row.onclick=()=>location.href=`/board.html?board=${encodeURIComponent(d.id)}`;
    el.appendChild(row);
  });
});

/* ===== ìµœì‹  ê¸€ í”¼ë“œ ===== */
onSnapshot(query(collection(db,'communityPosts'),orderBy('createdAt','desc'),limit(8)),(snap)=>{
  const feed=$('#feed');$('#post-count').textContent=snap.size+' posts';feed.innerHTML='';
  if(snap.empty){feed.innerHTML='<div class="meta">ì•„ì§ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';return;}
  snap.forEach(d=>{
    const x=d.data();
    const el=document.createElement('div');el.className='post-row';
    el.innerHTML=`
      <div class="post-title">${esc(x.title||'(ì œëª© ì—†ìŒ)')}</div>
      <div class="post-meta">${esc(x.authorName||'ìµëª…')} Â· ${fmt(x.createdAt)}</div>`;
    el.onclick=()=>location.href=`/post-view.html?id=${d.id}`;
    feed.appendChild(el);
  });
});

/* ===== ë°©ëª…ë¡ ===== */
const gbList=$('#guestbook'),gbInput=$('#gb-input'),gbAdd=$('#gb-add');
onSnapshot(query(collection(db,'communityPosts','guestbook','comments'),orderBy('createdAt','desc'),limit(8)),(snap)=>{
  gbList.innerHTML='';
  if(snap.empty){gbList.innerHTML='<div class="item"><div class="meta">ì²« ì¸ì‚¬ë¥¼ ë‚¨ê²¨ë³´ì„¸ìš”!</div></div>';return;}
  snap.forEach(c=>{
    const x=c.data();
    const row=document.createElement('div');row.className='item';
    row.innerHTML=`<b>${esc(x.authorName||'ìµëª…')}</b><div class="meta">${fmt(x.createdAt)}</div><div>${esc(x.text||'')}</div>`;
    gbList.appendChild(row);
  });
});
gbAdd.onclick=async()=>{
  const t=(gbInput.value||'').trim();if(!t)return alert('ë‚´ìš© ì…ë ¥');
  if(!auth.currentUser)return location.href='/login.html';
  await addDoc(collection(db,'communityPosts','guestbook','comments'),{
    text:t,authorUid:auth.currentUser.uid,authorName:myNick,createdAt:serverTimestamp()
  });
  gbInput.value='';
};

/* ===== ëª¨ë°”ì¼ í–„ë²„ê±° ë©”ë‰´ ===== */
const menuBtn=document.getElementById('menu-btn');
const aside=document.querySelector('aside.card');
menuBtn.addEventListener('click',()=>aside.classList.toggle('open'));

/* ===== FCM Push ===== */
const VAPID_KEY='BDR1RJklUhPgWbxUpsX-T9tsRCJamok1icmmkSgaz2NGoTj0HiaMpuJ7jY2hsPibWdIlZfC3XnuvMlA6TxOKQfQ';
async function initPush(user){
  try{
    if(!(await isSupported()))return;
    const reg=await navigator.serviceWorker.register('/sw.js');
    if(Notification.permission!=='granted'){
      const perm=await Notification.requestPermission();
      if(perm!=='granted')return;
    }
    const messaging=getMessaging(app);
    const token=await getToken(messaging,{vapidKey:VAPID_KEY,serviceWorkerRegistration:reg});
    if(token)await updateDoc(doc(db,'users',user.uid),{fcmToken:token});
    onMessage(messaging,p=>alert(`ğŸ“¢ ${p.notification?.title||'ìƒˆ ì•Œë¦¼'}\n${p.notification?.body||''}`));
  }catch(e){console.warn('FCM error',e);}
}
onAuthStateChanged(auth,(u)=>{if(u)initPush(u);});

/* ===== Chat FAB ë±ƒì§€ í‘œì‹œ ===== */
if('serviceWorker' in navigator){
  navigator.serviceWorker.addEventListener('message',(e)=>{
    if(e.data?.kind==='push'&&e.data.tag==='chat'){
      const b=document.getElementById('chat-fab-badge');
      b.style.display='flex';b.textContent='â—';
    }
  });
}

/* ===== Chat FAB í† ê¸€ ê¸°ëŠ¥ ===== */
const chatFab = document.getElementById('chat-fab');
const chatDrawer = document.getElementById('chat-drawer');
const chatDim = document.getElementById('chat-dim');
const chatClose = document.getElementById('chat-close');
const chatFrame = document.getElementById('chat-frame');

function openChat() {
  if (!auth.currentUser) return alert('ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.');
  chatFrame.src = '/chat.html?room=global';
  chatDrawer.classList.add('open');
  chatDim.style.display = 'block';
  document.body.style.overflow = 'hidden'; // âœ… body ìŠ¤í¬ë¡¤ ì ê¸ˆ
}


function closeChat() {
  chatDrawer.classList.remove('open');
  chatDim.style.display = 'none';
  document.body.style.overflow = ''; // âœ… body ìŠ¤í¬ë¡¤ ë³µì›
}

chatFab.addEventListener('click', openChat);
chatDim.addEventListener('click', closeChat);
chatClose.addEventListener('click', closeChat);
window.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') closeChat();
});








</script>
</body>
</html>
